<script type="text/javascript">
  function toggleLoading(from)
  {
    $("#ajax-loader").toggle();
  }
  
  $(document).ready(function(){
    $("#comment_content").autoGrow();
    $("#new_comment")
        .bind("ajax:loading",  function(){
          $(this).find('.ajax-loader').toggle();
          $(this).find(":input").attr('disabled', 'disabled');
        })
        .bind("ajax:success", function(obj, data, xhr) {
          $(this).find(".error_messages").hide();
          $(data).insertAfter($("#series_comments").children("div.new-bubble"));
          $(this).find(":input").not(":submit").val('');
        })
        .bind("ajax:failure", function(data, xhr, err) {
          console.info(xhr.responseText);
          if (xhr.status == 403)
            $(this).find(".error_messages").html($(xhr.responseText)).show();
        })
        .bind("ajax:complete", function(){          
          $(this).find(":input").removeAttr('disabled');
          $(this).find('.ajax-loader').toggle();
        });
    
    window.setInterval(function(){
      $(".poster-processing").each(function(){
        var poster = $(this);
        var parentDiv = $(this).parents("div.series_info");
        $.ajax({
          url: "/shows/" + parentDiv.attr("id").split('-')[1] + "/get_poster",
          success: function(data){
            poster.html(data);
            poster.removeClass("poster-processing");
          }
        });
      });
    }, 2000);
  });
</script>

<div class="left_articles">
	<div class="buttons">
	  <p>
	    <a href="#" class="bluebtn">Watc</a>&nbsp;
	    <a href="#" class="greenbtn">Mark</a>
	  </p>
	</div>
	<div id="series-<%= @series.id %>" class="series_info">
	  <h2><%= @series.name %></h2>
  	<p class="description">
  	  <%= people_watching(@series) %>
  	</p>
  	<p>
      <%= poster_processing(@series) %>
      <div>
        <% description = truncate(@series.description, 795, "") %>
        <%= description %>
        <% if @series.description.length > description.length %>
          <%= link_to_function("...", "showMoreDescription(this);") %>
          <span style="display:none">
            <%= @series.description[(description.length)..-1] %>
          </span>
        <% end %>
      </div>
      <div>
        <span class="label"><%= t '.air_time'%>:</span>
        <%= @series.air_day %> <%= t '.at' %>
        <%= @series.air_time %> (<%= @series.runtime %> mn)
      </div>
      <div>
        <span class="label">Genres:</span>
        <% for genre in @series.genres %>
          <%= link_to genre.name, shows_genre_path(genre) %>&nbsp;
        <% end %>
      </div>
  	</p>
  	<div style="clear:both"></div>
  </div>
</div>

<!-- Seasons -->
<%= render "seasons" %>

<!-- Comments -->
<%= render "comments" %>

<%= render :partial => "activity", :locals => { :series => @series } if current_user && @subscription %>
